<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE GVCore SYSTEM "http://www.greenvulcano.com/gvesb/dtds/GVCore.dtd">

<GVCore version="1.0">
    <GVCryptoHelper name="CRYPTO_HELPER" type="module"/>
    <GVXPath name="XPATH" type="module">
        <XPath xpath-factory="it.greenvulcano.util.xpath.search.jaxen.JaxenXPathAPIFactoryImpl">
            <Description>Extension functions and namespaces for XPath.</Description>
            <XPathExtension class="it.greenvulcano.util.xpath.search.extension.ExternalDocumentXPathFunction"
                            function-name="document">
                <Description><![CDATA[Accede ad un documento esterno. Uso: gvf:document('xml file path')]]></Description>
            </XPathExtension>
            <XPathNamespace namespace="http://www.w3.org/2001/XMLSchema" prefix="xsd"/>
            <XPathNamespace namespace="http://www.w3.org/2001/XMLSchema-instance"
                            prefix="xsi"/>
            <XPathNamespace namespace="http://schemas.xmlsoap.org/wsdl/soap/"
                            prefix="soap"/>
            <XPathNamespace namespace="http://schemas.xmlsoap.org/wsdl/" prefix="wsdl"/>
            <XPathNamespace namespace="http://jakarta.apache.org/log4j/" prefix="log4j"/>
            <XPathNamespace namespace="http://www.w3.org/XML/1998/namespace" prefix="xml"/>
            <XPathNamespace namespace="http://www.greenvulcano.it/greenvulcano"
                            prefix="gvesbws"/>
            <XPathNamespace namespace="http://www.greenvulcano.com/database" prefix="db"/>
            <XPathNamespace namespace="http://www.eaisoftware.it/jarad" prefix="jarad"/>
            <XPathNamespace namespace="http://www.greenvulcano.it/ldap" prefix="ldapc"/>
            <XPathNamespace namespace="http://drools.org/drools-5.0/change-set"
                            prefix="drools-cs"/>
            <XPathNamespace namespace="urn:hl7-org:v2xml" prefix="hl7"/>
        </XPath>
    </GVXPath>
    <GVForwards name="JMS_FORWARD" type="module">
        <ForwardConfiguration dump-message="true" enabled="true"
                              forwardName="FWD_TOUPPER_A" name="ToupperA"
                              ref-dp="ReadString_JMSBytesMessageDataProvider">
            <ForwardDeployment connection-factory="java:/XAConnectionFactory"
                               destination="gvesb/jms/queue/TOUPPER_A_Request_Queue"
                               destination-type="queue" reconnect-interval-sec="10"
                               transacted="true" transaction-timeout-sec="30">
                <XAHelper auto-enlist="false" transaction-status="TMSUCCESS"/>
            </ForwardDeployment>
        </ForwardConfiguration>
    </GVForwards>
    <GVPoolManager name="POOL_MANAGER" type="module">
        <GreenVulcanoPool default-timeout="5000" initial-size="1" maximum-creation="10"
                          maximum-size="5" shrink-timeout="120000"
                          subsystem="J2EEGreenVulcano"/>
        <GreenVulcanoPool default-timeout="5000" initial-size="1" maximum-creation="10"
                          maximum-size="5" shrink-timeout="120000" subsystem="JMSForward"/>
        <GreenVulcanoPool default-timeout="5000" initial-size="1" maximum-creation="10"
                          maximum-size="5" shrink-timeout="120000"
                          subsystem="GreenVulcano-TimerTask"/>
        <GreenVulcanoPool default-timeout="5000" initial-size="1" maximum-creation="10"
                          maximum-size="5" shrink-timeout="120000"
                          subsystem="GreenVulcano-WebServices"/>
        <GreenVulcanoPool default-timeout="5000" initial-size="1" maximum-creation="10"
                          maximum-size="5" shrink-timeout="120000"
                          subsystem="HttpInboundGateway"/>
        <GreenVulcanoPool default-timeout="5000" initial-size="1" maximum-creation="10"
                          maximum-size="5" shrink-timeout="120000"
                          subsystem="GVHL7Listener"/>
    </GVPoolManager>
    <GVServices name="SERVICES" type="module">
        <BpelEngineConfiguration deployMentUnitProcess="${{gv.app.home}}/BpelProcess"
                                 startServer="true" transactionTimeout="30">
            <EngineProperties name="gv-bpel.tx.factory.class"
                              value="org.apache.ode.axis2.util.JBossFactory"/>
            <EngineProperties name="gv-bpel.event.listeners"
                              value="org.apache.ode.bpel.common.evt.DebugBpelEventListener"/>
            <EngineProperties name="gv-bpel.db.ext.dataSource" value="ds.ode"/>
            <EngineProperties name="gv-bpel.db.mode" value="EXTERNAL"/>
            <EngineProperties name="gv-bpel.dao.factory"
                              value="org.apache.ode.daohib.bpel.BpelDAOConnectionFactoryImpl"/>
            <EngineProperties name="jta.UserTransaction" value="UserTransaction"/>
            <EngineProperties name="hibernate.hbm2ddl.auto" value="update"/>
        </BpelEngineConfiguration>
        <Management call-administration-on-init="no"/>
        <Persistence enabled="true" jdbc-connection-name="pool_persistence">
            <SequenceSQL>select recovery_seq.nextval from dual</SequenceSQL>
        </Persistence>
        <Groups>
            <Description>This section contains all the service groups.</Description>
            <Group group-activation="on" id-group="DEFAULT_GRP"/>
        </Groups>
        <Services>
            <Description>This section contains a list of all services provided by GreenVulcano ESB</Description>
            <Service group-name="DEFAULT_GRP" id-service="TOUPPER" service-activation="on"
                     statistics="off">
                <Operation class="it.greenvulcano.gvesb.core.flow.GVFlowWF"
                           name="RequestReply" operation-activation="on"
                           out-check-type="sys-svc-id" type="operation">
                    <Participant id-channel="TEST_CHANNEL" id-system="GVESB"/>
                    <Flow first-node="call_server" point-x="20" point-y="150">
                        <GVOperationNode class="it.greenvulcano.gvesb.core.flow.GVOperationNode"
                                         id="call_server" id-system="GVESB" input="input"
                                         next-node-id="end" op-type="call"
                                         operation-name="toupper_call" output="output"
                                         point-x="186" point-y="152" type="flow-node"/>
                        <GVEndNode class="it.greenvulcano.gvesb.core.flow.GVEndNode"
                                   end-business-process="yes" id="end" op-type="end"
                                   output="output" point-x="386" point-y="150"
                                   type="flow-node"/>
                    </Flow>
                </Operation>
            </Service>
            <Service group-name="DEFAULT_GRP" id-service="TOUPPER_A"
                     service-activation="on" statistics="off">
                <Operation class="it.greenvulcano.gvesb.core.flow.GVFlowWF" name="Request"
                           operation-activation="on" out-check-type="sys-svc-id"
                           type="operation">
                    <Participant id-channel="TEST_CHANNEL_A" id-system="GVESB"/>
                    <Flow first-node="enqueue_request" point-x="20" point-y="150">
                        <GVOperationNode class="it.greenvulcano.gvesb.core.flow.GVOperationNode"
                                         id="enqueue_request" id-system="GVESB"
                                         input="input" next-node-id="end"
                                         op-type="enqueue"
                                         operation-name="JMSEnqueueTo::TOUPPER_A_Req"
                                         output="output" point-x="147" point-y="146"
                                         type="flow-node"/>
                        <GVEndNode class="it.greenvulcano.gvesb.core.flow.GVEndNode"
                                   end-business-process="no" id="end" op-type="end"
                                   output="output" point-x="337" point-y="146"
                                   type="flow-node">
                            <ChangeGVBuffer clear-data="true"/>
                        </GVEndNode>
                    </Flow>
                </Operation>
                <Operation class="it.greenvulcano.gvesb.core.flow.GVFlowWF"
                           name="GetReply" operation-activation="on"
                           out-check-type="sys-svc-id" type="operation">
                    <Participant id-channel="TEST_CHANNEL_A" id-system="GVESB"/>
                    <Flow first-node="dequeue_response" point-x="20" point-y="150">
                        <GVOperationNode class="it.greenvulcano.gvesb.core.flow.GVOperationNode"
                                         id="dequeue_response" id-system="GVESB"
                                         input="input" next-node-id="end"
                                         op-type="dequeue"
                                         operation-name="JMSDequeueFrom::TOUPPER_A_Resp"
                                         output="output" point-x="149" point-y="142"
                                         type="flow-node">
                            <DequeueFilter>
                                <IDFilter enabled="yes" name="IDFilter" type="filter"
                                          use-input="yes"/>
                            </DequeueFilter>
                        </GVOperationNode>
                        <GVEndNode class="it.greenvulcano.gvesb.core.flow.GVEndNode"
                                   end-business-process="yes" id="end" op-type="end"
                                   output="output" point-x="410" point-y="148"
                                   type="flow-node"/>
                    </Flow>
                </Operation>
                <Operation class="it.greenvulcano.gvesb.core.flow.GVFlowWF"
                           forward-name="FWD_TOUPPER_A" name="Forward"
                           operation-activation="on" out-check-type="none"
                           type="operation">
                    <Participant id-channel="TEST_CHANNEL_A" id-system="GVESB"/>
                    <Flow first-node="call_server" point-x="20" point-y="150">
                        <GVOperationNode class="it.greenvulcano.gvesb.core.flow.GVOperationNode"
                                         id="call_server" id-system="GVESB" input="input"
                                         next-node-id="enqueue_response" op-type="call"
                                         operation-name="toupper_call" output="output"
                                         point-x="147" point-y="148" type="flow-node"/>
                        <GVOperationNode class="it.greenvulcano.gvesb.core.flow.GVOperationNode"
                                         id="enqueue_response" id-system="GVESB"
                                         input="output" next-node-id="end"
                                         op-type="enqueue"
                                         operation-name="JMSEnqueueTo::TOUPPER_A_Resp"
                                         output="output" point-x="319" point-y="152"
                                         type="flow-node"/>
                        <GVEndNode class="it.greenvulcano.gvesb.core.flow.GVEndNode"
                                   end-business-process="no" id="end" op-type="end"
                                   output="output" point-x="532" point-y="149"
                                   type="flow-node">
                            <ChangeGVBuffer clear-data="true"/>
                        </GVEndNode>
                    </Flow>
                </Operation>
            </Service>
        </Services>
    </GVServices>
    <GVSystems name="SYSTEMS" type="module">
        <Systems>
            <Description>This section contains a list of all systems connected to GreenVulcano ESB</Description>
            <System id-system="GVESB" system-activation="on">
                <Channel id-channel="TEST_CHANNEL">
                    <test-service-call class="it.greenvulcano.gvesb.virtual.internal.TestServiceCall"
                                       name="toupper_call" service="toupper"
                                       sleep-on-init="75" sleep-on-perform="50"
                                       type="call"/>
                </Channel>
                <Channel id-channel="TEST_CHANNEL_A">
                    <test-service-call class="it.greenvulcano.gvesb.virtual.internal.TestServiceCall"
                                       name="toupper_call" service="toupper" type="call"/>
                    <test-service-call class="it.greenvulcano.gvesb.virtual.internal.TestServiceCall"
                                       name="tolower_call" service="tolower" type="call"/>
                    <jms-enqueue acknowledge-type="auto-acknowledge"
                                 class="it.greenvulcano.gvesb.virtual.j2ee.JMSEnqueueOperation"
                                 connection-factory="java:/XAConnectionFactory"
                                 delivery-mode="persistent"
                                 destination-name="gvesb/jms/queue/TOUPPER_A_Request_Queue"
                                 destination-type="queue" dump-message="true"
                                 name="JMSEnqueueTo::TOUPPER_A_Req" priority="4"
                                 ref-dp="WriteString_JMSBytesMessageDataProvider"
                                 transacted="false" type="enqueue">
                        <XAHelper auto-enlist="false" transaction-status="TMSUCCESS"/>
                    </jms-enqueue>
                    <jms-enqueue acknowledge-type="auto-acknowledge"
                                 class="it.greenvulcano.gvesb.virtual.j2ee.JMSEnqueueOperation"
                                 connection-factory="java:/XAConnectionFactory"
                                 delivery-mode="persistent"
                                 destination-name="gvesb/jms/queue/TOUPPER_A_Response_Queue"
                                 destination-type="queue" dump-message="true"
                                 name="JMSEnqueueTo::TOUPPER_A_Resp" priority="4"
                                 ref-dp="WriteString_JMSBytesMessageDataProvider"
                                 transacted="false" type="enqueue">
                        <XAHelper auto-enlist="false" transaction-status="TMSUCCESS"/>
                    </jms-enqueue>
                    <jms-dequeue acknowledge-type="auto-acknowledge"
                                 class="it.greenvulcano.gvesb.virtual.j2ee.JMSDequeueOperation"
                                 connection-factory="java:/XAConnectionFactory"
                                 destination-name="gvesb/jms/queue/TOUPPER_A_Response_Queue"
                                 destination-type="queue" dump-message="true"
                                 keep-input-extra-properties="true"
                                 name="JMSDequeueFrom::TOUPPER_A_Resp"
                                 receive-timeout="10000"
                                 receive-timeout-overridable="false"
                                 receive-type="timeout"
                                 ref-dp="ReadString_JMSBytesMessageDataProvider"
                                 transacted="false" type="dequeue">
                        <XAHelper auto-enlist="false" transaction-status="TMSUCCESS"/>
                    </jms-dequeue>
                </Channel>
            </System>
        </Systems>
    </GVSystems>
    <GVPolicy name="POLICY_MANAGER" type="module">
        <Roles/>
        <Addresses>
            <AddressSet name="local">
                <Description>AddressSet description</Description>
                <Address address="127.0.0.1"/>
            </AddressSet>
        </Addresses>
        <ACLGreenVulcano class="it.greenvulcano.gvesb.policy.impl.ACLGreenVulcano"
                         type="acl-manager">
            <DefaultRes type="resource"/>
        </ACLGreenVulcano>
    </GVPolicy>
    <GVConcurrencyHandler name="CONCURRENCY_HANDLER" type="module">
        <SubSystems>
            <SubSystem name="GVCore">
                <ConcurrentService max-concurrency="5" service="TOUPPER"/>
            </SubSystem>
        </SubSystems>
    </GVConcurrencyHandler>
    <GVBufferDump log-dump-size="-1" name="BUFFER_DUMP" type="module"/>
    <GVDataTransformation name="GVDT" type="module">
        <DataSourceSets>
            <DataSourceSet name="Default">
                <LocalFSDataSource class="it.greenvulcano.gvesb.gvdte.config.LocalFSDataSource"
                                   formatHandled="xsl" name="DefaultXSL"
                                   repositoryHome="${{gv.app.home}}/gvdte/datasource/xsl"
                                   type="datasource"/>
                <LocalFSDataSource class="it.greenvulcano.gvesb.gvdte.config.LocalFSDataSource"
                                   formatHandled="xsd" name="DefaultXSD"
                                   repositoryHome="${{gv.app.home}}/gvdte/datasource/xsd"
                                   type="datasource"/>
                <LocalFSDataSource class="it.greenvulcano.gvesb.gvdte.config.LocalFSDataSource"
                                   formatHandled="xq" name="DefaultXQ"
                                   repositoryHome="${{gv.app.home}}/gvdte/datasource/xq"
                                   type="datasource"/>
                <LocalFSDataSource class="it.greenvulcano.gvesb.gvdte.config.LocalFSDataSource"
                                   formatHandled="bin" name="DefaultBIN"
                                   repositoryHome="${{gv.app.home}}/gvdte/datasource/bin"
                                   type="datasource"/>
            </DataSourceSet>
        </DataSourceSets>
        <Transformations>
            <Base64Transformation Operation="Encode"
                                  class="it.greenvulcano.gvesb.gvdte.transformers.bin.bin2bin.Base64Transformer"
                                  name="ToBase64" type="transformation"/>
            <Base64Transformation Operation="Decode"
                                  class="it.greenvulcano.gvesb.gvdte.transformers.bin.bin2bin.Base64Transformer"
                                  name="FromBase64" type="transformation"/>
            <XSLTransformation DataSourceSet="Default" XSLMapName="identity.xsl"
                               class="it.greenvulcano.gvesb.gvdte.transformers.xslt.XSLTransformer"
                               name="identityXML" type="transformation"/>
            <XSLTransformation DataSourceSet="Default"
                               XSLMapName="identityNoNamespace.xsl"
                               class="it.greenvulcano.gvesb.gvdte.transformers.xslt.XSLTransformer"
                               name="identityXMLNoNamespace" type="transformation"/>
            <XSLTransformation DataSourceSet="Default"
                               XSLMapName="DataHandler/RecoveryPoint/ListRecoveryPoint.xsl"
                               class="it.greenvulcano.gvesb.gvdte.transformers.xslt.XSLTransformer"
                               name="ListRecoveryPoint" type="transformation"/>
            <HL72XMLTransformation class="it.greenvulcano.gvesb.gvdte.transformers.hl7.HL72XMLTransformer"
                                   name="HL72XML" type="transformation"/>
            <XML2HL7Transformation class="it.greenvulcano.gvesb.gvdte.transformers.hl7.XML2HL7Transformer"
                                   name="XML2HL7" type="transformation"/>
            <XSLTransformation DataSourceSet="Default" XSLMapName="HL7/HL7_OK.xsl"
                               class="it.greenvulcano.gvesb.gvdte.transformers.xslt.XSLTransformer"
                               name="HL7_OK" type="transformation"/>
            <XSLTransformation DataSourceSet="Default" XSLMapName="HL7/HL7_KO.xsl"
                               class="it.greenvulcano.gvesb.gvdte.transformers.xslt.XSLTransformer"
                               name="HL7_KO" type="transformation"/>
        </Transformations>
    </GVDataTransformation>
    <GVTaskManagerConfiguration name="GVTASKS" type="module">
        <GVSchedulerBuilder class="it.greenvulcano.scheduler.util.quartz.impl.GVSchedulerBuilder"
                            maxThreads="3" type="scheduler-builder">
            <RamStore type="quartz-store"/>
            <Calendars/>
        </GVSchedulerBuilder>
        <TaskGroups>
            <TaskGroup enabled="true" name="SystemGroup">
                <LogCleanerTask auto-start="true"
                                class="it.greenvulcano.scheduler.util.log.LogCleanerTask"
                                delete-older-than="14" enabled="false"
                                log-directory="@{{LOG_DIR}}" name="LogCleaner" type="task"
                                zip-mode="zip" zip-older-than="7">
                    <Triggers>
                        <CronTriggerBuilder class="it.greenvulcano.scheduler.util.quartz.impl.trigger.CronTriggerBuilder"
                                            cronExpression="0 0 0/2 * * ?" enabled="true"
                                            name="Trg_2h_gv" type="cron-trigger">
                            <TgProperties>
                                <PropertyDef name="LOG_DIR" value="sp{{gv.app.home}}/log"/>
                            </TgProperties>
                        </CronTriggerBuilder>
                        <CronTriggerBuilder class="it.greenvulcano.scheduler.util.quartz.impl.trigger.CronTriggerBuilder"
                                            cronExpression="0 0 0/2 * * ?" enabled="true"
                                            name="Trg_2h_jboss" type="cron-trigger">
                            <TgProperties>
                                <PropertyDef name="LOG_DIR"
                                             value="sp{{jboss.server.log.dir}}"/>
                            </TgProperties>
                        </CronTriggerBuilder>
                    </Triggers>
                </LogCleanerTask>
            </TaskGroup>
        </TaskGroups>
    </GVTaskManagerConfiguration>
</GVCore>